cmake_minimum_required(VERSION 2.8.10)

project(UnitTests)

include(${CMAKE_SOURCE_DIR}/../Resources/CMake/OrthancStoneParameters.cmake)

if (ORTHANC_FRAMEWORK_SOURCE STREQUAL "system")
  set(ORTHANC_BOOST_COMPONENTS program_options)

  set(USE_SYSTEM_GOOGLE_TEST ON CACHE BOOL "Use the system version of Google Test")
  set(USE_GOOGLE_TEST_DEBIAN_PACKAGE OFF CACHE BOOL "Use the sources of Google Test shipped with libgtest-dev (Debian only)")
  mark_as_advanced(USE_GOOGLE_TEST_DEBIAN_PACKAGE)
  include(${ORTHANC_STONE_ROOT}/Resources/Orthanc/CMake/DownloadPackage.cmake)
  include(${ORTHANC_STONE_ROOT}/Resources/Orthanc/CMake/GoogleTestConfiguration.cmake)

else()
  set(ENABLE_GOOGLE_TEST ON)
endif()

set(ENABLE_OPENGL OFF)

include(${ORTHANC_STONE_ROOT}/Resources/CMake/OrthancStoneConfiguration.cmake)

add_executable(UnitTests
  ${AUTOGENERATED_SOURCES}
  ${BOOST_EXTENDED_SOURCES}
  ${GOOGLE_TEST_SOURCES}
  ${ORTHANC_STONE_ROOT}/UnitTestsSources/GenericToolboxTests.cpp
  ${ORTHANC_STONE_ROOT}/UnitTestsSources/ImageToolboxTests.cpp
  ${ORTHANC_STONE_ROOT}/UnitTestsSources/PixelTestPatternsTests.cpp
  ${ORTHANC_STONE_ROOT}/UnitTestsSources/SortedFramesTests.cpp
  ${ORTHANC_STONE_ROOT}/UnitTestsSources/TestCommands.cpp
  ${ORTHANC_STONE_ROOT}/UnitTestsSources/TestMessageBroker.cpp
  ${ORTHANC_STONE_ROOT}/UnitTestsSources/TestStrategy.cpp
  ${ORTHANC_STONE_ROOT}/UnitTestsSources/TestStructureSet.cpp
  ${ORTHANC_STONE_ROOT}/UnitTestsSources/UnitTestsMain.cpp
  ${ORTHANC_STONE_SOURCES}
  )

target_link_libraries(UnitTests ${DCMTK_LIBRARIES})
