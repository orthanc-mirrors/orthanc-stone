cmake_minimum_required(VERSION 2.8.10)

project(UnitTests)

include(${CMAKE_SOURCE_DIR}/../OrthancStone/Resources/CMake/OrthancStoneParameters.cmake)

if (ORTHANC_FRAMEWORK_SOURCE STREQUAL "system")
  set(ORTHANC_BOOST_COMPONENTS program_options)

  set(USE_SYSTEM_GOOGLE_TEST ON CACHE BOOL "Use the system version of Google Test")
  set(USE_GOOGLE_TEST_DEBIAN_PACKAGE OFF CACHE BOOL "Use the sources of Google Test shipped with libgtest-dev (Debian only)")
  mark_as_advanced(USE_GOOGLE_TEST_DEBIAN_PACKAGE)
  include(${ORTHANC_STONE_ROOT}/Resources/Orthanc/CMake/DownloadPackage.cmake)
  include(${ORTHANC_STONE_ROOT}/Resources/Orthanc/CMake/GoogleTestConfiguration.cmake)

else()
  set(ENABLE_GOOGLE_TEST ON)
endif()

set(ENABLE_OPENGL OFF)
set(ENABLE_PUGIXML ON)

include(${ORTHANC_STONE_ROOT}/Resources/CMake/OrthancStoneConfiguration.cmake)

add_executable(UnitTests
  ${CMAKE_SOURCE_DIR}/GenericToolboxTests.cpp
  ${CMAKE_SOURCE_DIR}/ImageToolboxTests.cpp
  ${CMAKE_SOURCE_DIR}/PixelTestPatternsTests.cpp
  ${CMAKE_SOURCE_DIR}/SortedFramesTests.cpp
  ${CMAKE_SOURCE_DIR}/TestMessageBroker.cpp
  ${CMAKE_SOURCE_DIR}/TestStrategy.cpp
  ${CMAKE_SOURCE_DIR}/TestStructureSet.cpp
  ${CMAKE_SOURCE_DIR}/UnitTestsMain.cpp

  ${AUTOGENERATED_SOURCES}
  ${BOOST_EXTENDED_SOURCES}
  ${GOOGLE_TEST_SOURCES}
  ${ORTHANC_STONE_SOURCES}
  )

target_link_libraries(UnitTests ${DCMTK_LIBRARIES})
